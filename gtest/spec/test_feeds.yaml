title: Feeds

programs:
  - id: 1
    path: target/wasm32-unknown-unknown/release/gear-feeds-router.wasm

  - id: 2
    path: target/wasm32-unknown-unknown/release/gear-feeds-channel.wasm

fixtures:
  - title: Test GEAR Feeds Contracts

    messages:
      - destination: 1
        payload:
          kind: custom
          value:
            register: 41420f0000000000000000000000000000000000000000000000000000000000 # id of 2?

      - destination: 2
        payload:
          kind: custom
          value: subscribe # is this an action?

      - destination: 2
        payload:
          kind: custom
          value:
            post: "Hello world"

      - destination: 2
        payload:
          kind: custom
          value: channelFeed

    expected:
      - log:
        # Channel responds with Meta
        - destination: 0
          source:
            kind: id
            value: 2
          payload:
            kind: custom
            value:
              meta:
                name: Test
                owner_id: ???

        # Router responds with [Channel] on success
        - destination: 0
          source:
            kind: id
            value: 1
          payload:
            kind: custom
            value: [
              channel:
                id: ???
                name: Test
                owner_id: ???
            ] # vec?

        # Subscription success
        - destination: 0
          source:
            kind: id
            value: 1
          payload:
            kind: custom
            value: [
              message:
                text: success
                timestamp: 0
            ] # vec?

        # Post sent to subscriber(s)
        - destination: 0
          source:
            kind: id
            value: 1
          payload:
            kind: custom
            value:
              message:
                text: "Hello world",
                timestamp: ???

        # Post success
        - destination: 0
          source:
            kind: id
            value: 1
          payload:
            kind: custom
            value: [
              message:
                text: success,
                timestamp: 0,
            ] # vec?

        # ChannelFeed
        - destination: 0
          source:
            kind: id
            value: 1
          payload:
            kind: custom
            value: [
              message:
                text: "Channel Test was created by ???"
                timestamp: ???,
              message:
                text: "Hello world!"
                timestamp: ???
            ] # vec?
